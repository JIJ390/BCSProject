<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.kh.bcs.deviceList.mapper.DeviceListMapper">
  	
  	<select id="selectFilterList">
  	
	  SELECT 
    <choose>
        <when test="filterType == 'ram'">
            RAM.DEVICE_RAM_CAPACITY
        </when>
        <when test="filterType == 'hdd'">
            CAP.CAPACITY_TYPE
        </when>
        <when test="filterType == 'inch'">
            DISP.DEVICE_DISPLAY_SIZE
        </when>
    </choose>
    FROM DEVICE D
	    JOIN RAM ON D.DEVICE_RAM_CODE = RAM.DEVICE_RAM_CODE
	    JOIN DISPLAY DISP ON D.DEVICE_DISPLAY_CODE = DISP.DEVICE_DISPLAY_CODE
	    JOIN CAPACITY_PRICE CP ON D.DEVICE_NO = CP.DEVICE_NO
	    JOIN CAPACITY CAP ON CP.CAPACITY_NUMBER = CAP.CAPACITY_NUMBER
  	</select>
  	
  	



	<select id="selectDeviceList">
	
	SELECT DEVICE_NO, DEVICE_NAME, DEVICE_BUYING_PRICE
	FROM (
	
	
		<if test="hddList.size > 0">
			(
			SELECT D.DEVICE_NO AS "DEVICE_NO", DEVICE_NAME, DEVICE_BUYING_PRICE
			FROM CAPACITY C 
			JOIN CAPACITY_PRICE CP ON (C.CAPACITY_NUMBER = CP.CAPACITY_NUMBER)
			JOIN DEVICE D ON (CP.DEVICE_NO = D.DEVICE_NO)
			WHERE CAPACITY_TYPE IN 
			<foreach collection="hddList" item="item" open="(" separator="," close=")">
	        	#{item}
	   		</foreach>
			) 
			
		</if>
		
		<if test="(hddList.size > 0 and ramList.size > 0)">
			INTERSECT
		</if>
					
		<if test="ramList.size > 0">
		
			(
			SELECT DEVICE_NO, DEVICE_NAME, DEVICE_BUYING_PRICE
			FROM RAM
			JOIN DEVICE USING (DEVICE_RAM_CODE)
			WHERE DEVICE_RAM_CAPACITY IN 
			<foreach collection="ramList" item="item" open="(" separator="," close=")">
	        	#{item}
	   		</foreach>
			)
			
		</if>
		
		<if test="(ramList.size > 0  and inchList.size > 0) or (hddList.size > 0  and inchList.size > 0)">
			INTERSECT
		</if>
		
		<if test="inchList.size > 0">
		
			(
			SELECT DEVICE_NO, DEVICE_NAME, DEVICE_BUYING_PRICE
			FROM DISPLAY
			JOIN DEVICE USING (DEVICE_DISPLAY_CODE)
			WHERE DEVICE_DISPLAY_SIZE IN 
			<foreach collection="inchList" item="item" open="(" separator="," close=")">
	        	#{item}
	   		</foreach>
			)
		
		</if>
	
	)
	
	
	</select>
	
	

	<select id="phoneList">
		SELECT DEVICE_NO, DEVICE_NAME
		FROM DEVICE
		WHERE DEVICE_BRAND = #{category}
		ORDER BY DEVICE_RELEASE_DATE DESC
	
	</select>  	
</mapper>
