<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="/css/common/header.css">
  <script src="https://code.jquery.com/jquery-latest.min.js"></script>
  <script src="https://kit.fontawesome.com/b289d4a0af.js" crossorigin="anonymous"></script>
  <title>BCS 회원관리</title>
  <style>
    .member-mamage-body {
      width: 1000px;
      height: max-content;
      margin: auto;
      margin-top: 100px;
      margin-bottom: 100px;
    }

    .member-manage {
      width: 1000px;
      height: max-content;
      background-color: white;
      border-radius: 5px;
      padding: 30px;
    }

    .member-mamage-title {
      width: 100%;
      height: 50px;
      border-bottom: 1px solid gray;
      display: flex;
      align-items: center;
    }

    .member-mamage {
      width: 100%;
      height: 1000px;
      border-bottom: 1px solid gray;
      display: flex;
      justify-content: space-around;
    }

    .member-manage-row {
      width: 100%;
      height: 50px;
      border-bottom: 1px solid gray;
      display: flex;
      justify-content: space-around;
      align-items: center;
    }

    .member-manage-row > span{
      text-align: center;
    }

    .member-manage-search {
      margin-bottom: 10px;
      display: flex;
    }

    .member-manage-search> :nth-child(1) {
      width: 100px;
      height: 40px;
      border: 1px solid black;
      border-right: 1px dotted gray;
      background-color: white;
      border-top-left-radius: 10px;
      border-bottom-left-radius: 10px;
      margin: 0;
      position: relative
    }

    .member-manage-search> :nth-child(2) {
      width: 200px;
      height: 40px;
      border: 1px solid black;
      border-left: 0;
      border-right: 0;
      background-color: white;
      outline: none;
      padding-left: 5px;
      margin: 0;
    }

    .member-manage-search> :nth-child(3) {
      width: 50px;
      height: 40px;
      border: 1px solid black;
      border-left: 0;
      background-color: white;
      border-top-right-radius: 10px;
      border-bottom-right-radius: 10px;
      margin: 0;
    }

    .mamber-manage-search-category {
      width: 100px;
      height: 100px;
      border: 1px solid gray;
      position: absolute;
      z-index: 10;
      background-color: white;
      top: 40px;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      overflow: hidden;
    }

    .mamber-manage-search-category>p {
      height: 25px;
      width: 100%;
      padding-top: 3px;
    }

    .mamber-manage-search-category>p:hover {
      background-color: rgb(192, 192, 192);
      height: 25px;
      width: 100%;
      padding-top: 3px;
    }

    .member-manage-category-hidden {
      display: none;
    }

    .admin-member-pagenation {
      width: 40%;
      height: 50px;
      margin: auto;
      margin-top: 20px;

      display: flex;
      justify-content: space-around;
      align-content: center;

    }
    .admin-member-pagenation > button{
      border: 0;
      background-color: white;
      font-size: 20px;
      margin: 0 10px;
      padding: 5px;
    }
    .pnNumber>button{
      border: 0;
      background-color: white;
      font-size: 20px;
    }


    .pnNumber{
      width: 200px;
      display: flex;
      justify-content: start;
      align-content: center;
    }

    .pnNumber > button{
      padding: 10px;
    }

    .admin-member-detail{
      position: absolute;
      width: 500px;
      height: 500px;
      background-color: white;
      border: 1px solid black;
      bottom: 0;
      top: 0;
      margin: auto;
    }
  </style>

  </style>
</head>

<body>

  <th:block th:replace="~{common/header}"></th:block>

  <div class="admin-member-detail">

  </div>

  <div class="member-mamage-body">
    <div class="member-manage">
      <div style="width: 100%;">
        <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
          <p style="font-size: 40px;">회원 관리 페이지</p>
          <div class="member-manage-search">
            <button class="member-manage-category-menuBtn"
            style="display: flex; justify-content: center; align-items: center;">
            <p class="member-manage-category">회원번호</p>
            <i class="fa-solid fa-caret-down" style="margin-left: 5px;"></i>
            <div class="mamber-manage-search-category member-manage-category-hidden">
              <p class="member-manage-search-list">회원번호</p>
              <p class="member-manage-search-list">이름</p>
              <p class="member-manage-search-list">이메일</p>
              <p class="member-manage-search-list">전화번호</p>
            </div>
          </button>
          <input type="text">
          <button>
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>
        </div>
      </div>
    </div>
    <hr>
    <div class="member-mamage-title">
      <span style="font-size: 20px; margin-left: 20px;">회원 번호<i style="padding-left: 5px;" class="넘버 fa-solid fa-caret-down"></i></span>
      <span style="font-size: 20px; margin-left: 115px;">이름<i style="padding-left: 5px;" class="이름 fa-solid fa-caret-down"></i></span>
      <span style="font-size: 20px; margin-left: 215px;">이메일<i style="padding-left: 5px;" class="이메일 fa-solid fa-caret-down"></i></span>
      <span style="font-size: 20px; margin-left: 215px;">전화 번호<i style="padding-left: 5px;" class="전화번호 fa-solid fa-caret-down"></i></span>
      <!-- <i class="fa-solid fa-caret-up"></i> -->
    </div>
    <div class="member-mamage-content">
      <!-- <div class="member-manage-row">
        <span style="font-size: 20px;">1</span>
        <span style="font-size: 20px;">홍길동</span>
        <span style="font-size: 20px;">member01@abc.co.kr</span>
        <span style="font-size: 20px;">010-1234-1234</span>
      </div> -->
    </div>
    <div class="admin-member-pagenation">
      <!-- <button><i class="fa-solid fa-backward-fast"></i></button>
      <button><i class="fa-solid fa-caret-left"></i></button>
      <button class="admin-member-page">1</button>
      <button class="admin-member-page">2</button>
      <button class="admin-member-page">3</button>
      <button class="admin-member-page">4</button>
      <button class="admin-member-page">5</button>
      <button><i class="fa-solid fa-caret-right"></i></button>
      <button><i class="fa-solid fa-forward-fast"></i></i></div> -->
      </div>
    </div>
  </div>
  
  <th:block th:replace="~{common/footer}"></th:block>
  <script>
    
    const memberManageCategory = document.querySelector(".mamber-manage-search-category");
    const memberManageCategoryBtn = document.querySelector(".member-manage-category-menuBtn");
    
    $(function () {
      $(".member-manage-category-menuBtn").on("click", function () {
        $(".mamber-manage-search-category").slideToggle("fast"); // 2초에 걸쳐서 진행
      })
    })
    
    const categoryList = document.querySelectorAll(".member-manage-search-list");
    for (let i = 0; i < categoryList.length; i++) {
      categoryList[i].addEventListener("click", () => {
        document.querySelector(".member-manage-category").innerText = categoryList[i].innerText;
      })
    }


    const adminMemberNo = document.querySelector(".넘버");
    const adminMemberName = document.querySelector(".이름");
    const adminMemberEmail = document.querySelector(".이메일");
    const adminMemberTel = document.querySelector(".전화번호");
    let searchType = "";
    let searchText = "";


    let cp = 1;
    let ud = 1;

    const getMemberAsc = () => {
      adminMemberNo.addEventListener("click", () => {
        searchType = '회원번호';
        if(ud === 1){
          ud = 2;
          getMemberPagenation();
          getMemberSearchList();
          adminMemberNo.classList.add("fa-caret-up");
          adminMemberNo.classList.remove("fa-caret-down");
        }
        else {
          ud = 1;
          getMemberPagenation();
          getMemberSearchList();
          adminMemberNo.classList.remove("fa-caret-up");
          adminMemberNo.classList.add("fa-caret-down");
        }
      })


      adminMemberName.addEventListener("click", () => {
        searchType = '이름'
        if(ud === 1){
          ud = 2;
          getMemberPagenation();
          getMemberSearchList();
          adminMemberName.classList.add("fa-caret-up");
          adminMemberName.classList.remove("fa-caret-down");
        }
        else {
          ud = 1;
          getMemberPagenation();
          getMemberSearchList();
          adminMemberName.classList.remove("fa-caret-up");
          adminMemberName.classList.add("fa-caret-down");
        }
      })


      adminMemberEmail.addEventListener("click", () => {
        searchType = '이메일'
        if(ud === 1){
          ud = 2;
          getMemberPagenation();
          getMemberSearchList();
          adminMemberEmail.classList.add("fa-caret-up");
          adminMemberEmail.classList.remove("fa-caret-down");
        }
        else {
          ud = 1;
          getMemberPagenation();
          getMemberSearchList();
          adminMemberEmail.classList.remove("fa-caret-up");
          adminMemberEmail.classList.add("fa-caret-down");
        }
      })


      adminMemberTel.addEventListener("click", () => {
        searchType = '전화번호'
        if(ud === 1){
          ud = 2;
          getMemberPagenation();
          getMemberSearchList();
          adminMemberTel.classList.add("fa-caret-up");
          adminMemberTel.classList.remove("fa-caret-down");
        }
        else {
          ud = 1;
          getMemberPagenation();
          getMemberSearchList();
          adminMemberTel.classList.remove("fa-caret-up");
          adminMemberTel.classList.add("fa-caret-down");
        }
      })





    }

    const getMemberPagenation = () => {
      searchType = document.querySelector(".member-manage-category-menuBtn").innerText;
      const searchText = document.querySelector(".member-manage-search").children[1].value;
      fetch("/admin/adminMemberPage?searchType="+searchType+"&searchText="+searchText+"&cp="+cp)
      .then(response => {
        if(response.ok){
          return response.text();
        }
        throw new Error("cp 개수 조회 실패");
      })
      .then(html => {
        document.querySelector(".admin-member-pagenation").innerHTML = html;
        getPnEvent();
        getMemberPnClick();
   
          const cpUnderLine = (cp-1) % 5;
          const pnValue = document.querySelectorAll(".pnValue");
  
          pnValue[cpUnderLine].style.borderBottom = '1px solid black';




      })
      .catch(err => {
        console.log(err);
      })

    }


    const getMemberSearchList = () => {

      searchText = document.querySelector(".member-manage-search").children[1].value;

      var numRegex = /^[0-9]*$/;
      if(searchType === '회원번호'){
        if(!numRegex.test(searchText)){
          alert("형식에 맞게 입력해주세요")
          return;
        }
      }

      if(searchType === '전화번호'){
        if(!numRegex.test(searchText)){
          alert("형식에 맞게 입력해주세요")
          return;
        }
      }


      fetch("/admin/adminMemberSearch?cp="+cp+"&searchType="+searchType+"&searchText="+searchText+"&ud="+ud)
      .then(response => {
        if(response.ok){
          return response.text();
        }
        throw new Error("리스트 조회 실패");
        
      })
      .then(html => {
        document.querySelector(".member-mamage-content").innerHTML = html;
        
      })
      .catch(err => {
        console.log(err);
      })
    }

    const getPnEvent = () => {

      document.querySelector(".pn-1").addEventListener("click", () => {
        cp = 1;
        getMemberPagenation();
        getMemberSearchList();
      })
      document.querySelector(".pn-2").addEventListener("click", () => {
        cp--;
        if(cp === 0){
          cp++;
        }
        getMemberPagenation();
        getMemberSearchList();
      })
      document.querySelector(".pn-3").addEventListener("click", () => {
        cp++;
        if(cp > Number(document.querySelector(".getCpCount").value)){
          cp--;
        }
        getMemberPagenation();
        getMemberSearchList();
      })
      document.querySelector(".pn-4").addEventListener("click", () => {
        cp = Number(document.querySelector(".getCpCount").value);
        getMemberPagenation();
        getMemberSearchList(); 
      })
      document.querySelector(".pn-5")?.addEventListener("click", () => {
        cp = Number(document.querySelector(".getCpCount").value);
        getMemberPagenation();
        getMemberSearchList(); 
      })

    }


    const memberSearchBtn = () => {
      document.querySelector(".member-manage-search").children[2].addEventListener("click", () => {
        cp = 1;
        getMemberPagenation();
        getMemberSearchList();
      })
    }

    const getMemberPnClick = () => {
      const pnBtn = document.querySelectorAll(".pnBtn");
      const pnValue = document.querySelectorAll(".pnValue");
     
        for(let i = 0; i < pnBtn.length; i++){

          pnBtn[i].addEventListener("click", () => {
            cp = Number(pnValue[i].innerText);
            getMemberPagenation();
            getMemberSearchList();
          })

        }
      
    }



    document.addEventListener("DOMContentLoaded", () => {
      getMemberPagenation();
      getMemberSearchList();
      memberSearchBtn();
      getMemberAsc();
    })

  </script>
</body>

</html>